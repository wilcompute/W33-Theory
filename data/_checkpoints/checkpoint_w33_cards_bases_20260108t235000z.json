{
  "timestamp_utc": "2026-01-08T23:24:33Z",
  "purpose": "Build a canonical 10x4 'quantum cards' labeling (ranks+suits) on N12_58-derived W(3,3) points, and express all 40 isotropic lines as 40 tetrads (bases) in that card notation. This yields a Witting-style 40-state/40-base contextuality table with Sp(4,3) symmetry order 51840 up to relabeling.",
  "inputs": {
    "N12_58_W33_points.csv": {
      "path": "/mnt/data/N12_58_W33_points.csv",
      "sha256": "822518e6188326061024bd0b2b37c1d31f328ce0f70745a3ecc01dc080349277"
    },
    "N12_58_W33_lines.csv": {
      "path": "/mnt/data/N12_58_W33_lines.csv",
      "sha256": "cb2358d857177c3c7987fe70d37dd2dd4d21ec4e01cf1edc79e17452211b5eea"
    },
    "N12_58_W33_spread10_cards.csv": {
      "path": "/mnt/data/N12_58_W33_spread10_cards.csv",
      "sha256": "4a736599b06c652b52f12826c780857d583b5b80be6614b1c2d294e96b8c5786"
    }
  },
  "results": {
    "point_to_card": [
      {
        "point_id": 0,
        "rank": 1,
        "suit": "♠",
        "suit_name": "S",
        "card": "1♠",
        "coords": [
          0,
          0,
          0,
          1
        ]
      },
      {
        "point_id": 1,
        "rank": 2,
        "suit": "♠",
        "suit_name": "S",
        "card": "2♠",
        "coords": [
          0,
          0,
          1,
          0
        ]
      },
      {
        "point_id": 2,
        "rank": 3,
        "suit": "♠",
        "suit_name": "S",
        "card": "3♠",
        "coords": [
          0,
          0,
          1,
          1
        ]
      },
      {
        "point_id": 3,
        "rank": 4,
        "suit": "♠",
        "suit_name": "S",
        "card": "4♠",
        "coords": [
          0,
          0,
          1,
          2
        ]
      },
      {
        "point_id": 4,
        "rank": 1,
        "suit": "♡",
        "suit_name": "H",
        "card": "1♡",
        "coords": [
          0,
          1,
          0,
          0
        ]
      },
      {
        "point_id": 5,
        "rank": 1,
        "suit": "♢",
        "suit_name": "D",
        "card": "1♢",
        "coords": [
          0,
          1,
          0,
          1
        ]
      },
      {
        "point_id": 6,
        "rank": 1,
        "suit": "♣",
        "suit_name": "C",
        "card": "1♣",
        "coords": [
          0,
          1,
          0,
          2
        ]
      },
      {
        "point_id": 7,
        "rank": 5,
        "suit": "♠",
        "suit_name": "S",
        "card": "5♠",
        "coords": [
          0,
          1,
          1,
          0
        ]
      },
      {
        "point_id": 8,
        "rank": 6,
        "suit": "♠",
        "suit_name": "S",
        "card": "6♠",
        "coords": [
          0,
          1,
          1,
          1
        ]
      },
      {
        "point_id": 9,
        "rank": 7,
        "suit": "♠",
        "suit_name": "S",
        "card": "7♠",
        "coords": [
          0,
          1,
          1,
          2
        ]
      },
      {
        "point_id": 10,
        "rank": 8,
        "suit": "♠",
        "suit_name": "S",
        "card": "8♠",
        "coords": [
          0,
          1,
          2,
          0
        ]
      },
      {
        "point_id": 11,
        "rank": 9,
        "suit": "♠",
        "suit_name": "S",
        "card": "9♠",
        "coords": [
          0,
          1,
          2,
          1
        ]
      },
      {
        "point_id": 12,
        "rank": 10,
        "suit": "♠",
        "suit_name": "S",
        "card": "10♠",
        "coords": [
          0,
          1,
          2,
          2
        ]
      },
      {
        "point_id": 13,
        "rank": 2,
        "suit": "♡",
        "suit_name": "H",
        "card": "2♡",
        "coords": [
          1,
          0,
          0,
          0
        ]
      },
      {
        "point_id": 14,
        "rank": 10,
        "suit": "♡",
        "suit_name": "H",
        "card": "10♡",
        "coords": [
          1,
          0,
          0,
          1
        ]
      },
      {
        "point_id": 15,
        "rank": 7,
        "suit": "♡",
        "suit_name": "H",
        "card": "7♡",
        "coords": [
          1,
          0,
          0,
          2
        ]
      },
      {
        "point_id": 16,
        "rank": 2,
        "suit": "♢",
        "suit_name": "D",
        "card": "2♢",
        "coords": [
          1,
          0,
          1,
          0
        ]
      },
      {
        "point_id": 17,
        "rank": 8,
        "suit": "♡",
        "suit_name": "H",
        "card": "8♡",
        "coords": [
          1,
          0,
          1,
          1
        ]
      },
      {
        "point_id": 18,
        "rank": 5,
        "suit": "♡",
        "suit_name": "H",
        "card": "5♡",
        "coords": [
          1,
          0,
          1,
          2
        ]
      },
      {
        "point_id": 19,
        "rank": 2,
        "suit": "♣",
        "suit_name": "C",
        "card": "2♣",
        "coords": [
          1,
          0,
          2,
          0
        ]
      },
      {
        "point_id": 20,
        "rank": 6,
        "suit": "♡",
        "suit_name": "H",
        "card": "6♡",
        "coords": [
          1,
          0,
          2,
          1
        ]
      },
      {
        "point_id": 21,
        "rank": 9,
        "suit": "♡",
        "suit_name": "H",
        "card": "9♡",
        "coords": [
          1,
          0,
          2,
          2
        ]
      },
      {
        "point_id": 22,
        "rank": 4,
        "suit": "♡",
        "suit_name": "H",
        "card": "4♡",
        "coords": [
          1,
          1,
          0,
          0
        ]
      },
      {
        "point_id": 23,
        "rank": 8,
        "suit": "♢",
        "suit_name": "D",
        "card": "8♢",
        "coords": [
          1,
          1,
          0,
          1
        ]
      },
      {
        "point_id": 24,
        "rank": 6,
        "suit": "♢",
        "suit_name": "D",
        "card": "6♢",
        "coords": [
          1,
          1,
          0,
          2
        ]
      },
      {
        "point_id": 25,
        "rank": 9,
        "suit": "♢",
        "suit_name": "D",
        "card": "9♢",
        "coords": [
          1,
          1,
          1,
          0
        ]
      },
      {
        "point_id": 26,
        "rank": 7,
        "suit": "♢",
        "suit_name": "D",
        "card": "7♢",
        "coords": [
          1,
          1,
          1,
          1
        ]
      },
      {
        "point_id": 27,
        "rank": 4,
        "suit": "♢",
        "suit_name": "D",
        "card": "4♢",
        "coords": [
          1,
          1,
          1,
          2
        ]
      },
      {
        "point_id": 28,
        "rank": 10,
        "suit": "♢",
        "suit_name": "D",
        "card": "10♢",
        "coords": [
          1,
          1,
          2,
          0
        ]
      },
      {
        "point_id": 29,
        "rank": 4,
        "suit": "♣",
        "suit_name": "C",
        "card": "4♣",
        "coords": [
          1,
          1,
          2,
          1
        ]
      },
      {
        "point_id": 30,
        "rank": 5,
        "suit": "♢",
        "suit_name": "D",
        "card": "5♢",
        "coords": [
          1,
          1,
          2,
          2
        ]
      },
      {
        "point_id": 31,
        "rank": 3,
        "suit": "♡",
        "suit_name": "H",
        "card": "3♡",
        "coords": [
          1,
          2,
          0,
          0
        ]
      },
      {
        "point_id": 32,
        "rank": 9,
        "suit": "♣",
        "suit_name": "C",
        "card": "9♣",
        "coords": [
          1,
          2,
          0,
          1
        ]
      },
      {
        "point_id": 33,
        "rank": 5,
        "suit": "♣",
        "suit_name": "C",
        "card": "5♣",
        "coords": [
          1,
          2,
          0,
          2
        ]
      },
      {
        "point_id": 34,
        "rank": 6,
        "suit": "♣",
        "suit_name": "C",
        "card": "6♣",
        "coords": [
          1,
          2,
          1,
          0
        ]
      },
      {
        "point_id": 35,
        "rank": 3,
        "suit": "♢",
        "suit_name": "D",
        "card": "3♢",
        "coords": [
          1,
          2,
          1,
          1
        ]
      },
      {
        "point_id": 36,
        "rank": 10,
        "suit": "♣",
        "suit_name": "C",
        "card": "10♣",
        "coords": [
          1,
          2,
          1,
          2
        ]
      },
      {
        "point_id": 37,
        "rank": 7,
        "suit": "♣",
        "suit_name": "C",
        "card": "7♣",
        "coords": [
          1,
          2,
          2,
          0
        ]
      },
      {
        "point_id": 38,
        "rank": 8,
        "suit": "♣",
        "suit_name": "C",
        "card": "8♣",
        "coords": [
          1,
          2,
          2,
          1
        ]
      },
      {
        "point_id": 39,
        "rank": 3,
        "suit": "♣",
        "suit_name": "C",
        "card": "3♣",
        "coords": [
          1,
          2,
          2,
          2
        ]
      }
    ],
    "rank_spread_lines": [
      {
        "rank": 1,
        "line_id": 17,
        "point_ids_ordered": [
          0,
          4,
          5,
          6
        ],
        "coords_ordered": [
          {
            "point_id": 0,
            "coords": [
              0,
              0,
              0,
              1
            ]
          },
          {
            "point_id": 4,
            "coords": [
              0,
              1,
              0,
              0
            ]
          },
          {
            "point_id": 5,
            "coords": [
              0,
              1,
              0,
              1
            ]
          },
          {
            "point_id": 6,
            "coords": [
              0,
              1,
              0,
              2
            ]
          }
        ]
      },
      {
        "rank": 2,
        "line_id": 26,
        "point_ids_ordered": [
          1,
          13,
          16,
          19
        ],
        "coords_ordered": [
          {
            "point_id": 1,
            "coords": [
              0,
              0,
              1,
              0
            ]
          },
          {
            "point_id": 13,
            "coords": [
              1,
              0,
              0,
              0
            ]
          },
          {
            "point_id": 16,
            "coords": [
              1,
              0,
              1,
              0
            ]
          },
          {
            "point_id": 19,
            "coords": [
              1,
              0,
              2,
              0
            ]
          }
        ]
      },
      {
        "rank": 3,
        "line_id": 6,
        "point_ids_ordered": [
          2,
          31,
          35,
          39
        ],
        "coords_ordered": [
          {
            "point_id": 2,
            "coords": [
              0,
              0,
              1,
              1
            ]
          },
          {
            "point_id": 31,
            "coords": [
              1,
              2,
              0,
              0
            ]
          },
          {
            "point_id": 35,
            "coords": [
              1,
              2,
              1,
              1
            ]
          },
          {
            "point_id": 39,
            "coords": [
              1,
              2,
              2,
              2
            ]
          }
        ]
      },
      {
        "rank": 4,
        "line_id": 23,
        "point_ids_ordered": [
          3,
          22,
          27,
          29
        ],
        "coords_ordered": [
          {
            "point_id": 3,
            "coords": [
              0,
              0,
              1,
              2
            ]
          },
          {
            "point_id": 22,
            "coords": [
              1,
              1,
              0,
              0
            ]
          },
          {
            "point_id": 27,
            "coords": [
              1,
              1,
              1,
              2
            ]
          },
          {
            "point_id": 29,
            "coords": [
              1,
              1,
              2,
              1
            ]
          }
        ]
      },
      {
        "rank": 5,
        "line_id": 30,
        "point_ids_ordered": [
          7,
          18,
          30,
          33
        ],
        "coords_ordered": [
          {
            "point_id": 7,
            "coords": [
              0,
              1,
              1,
              0
            ]
          },
          {
            "point_id": 18,
            "coords": [
              1,
              0,
              1,
              2
            ]
          },
          {
            "point_id": 30,
            "coords": [
              1,
              1,
              2,
              2
            ]
          },
          {
            "point_id": 33,
            "coords": [
              1,
              2,
              0,
              2
            ]
          }
        ]
      },
      {
        "rank": 6,
        "line_id": 7,
        "point_ids_ordered": [
          8,
          20,
          24,
          34
        ],
        "coords_ordered": [
          {
            "point_id": 8,
            "coords": [
              0,
              1,
              1,
              1
            ]
          },
          {
            "point_id": 20,
            "coords": [
              1,
              0,
              2,
              1
            ]
          },
          {
            "point_id": 24,
            "coords": [
              1,
              1,
              0,
              2
            ]
          },
          {
            "point_id": 34,
            "coords": [
              1,
              2,
              1,
              0
            ]
          }
        ]
      },
      {
        "rank": 7,
        "line_id": 2,
        "point_ids_ordered": [
          9,
          15,
          26,
          37
        ],
        "coords_ordered": [
          {
            "point_id": 9,
            "coords": [
              0,
              1,
              1,
              2
            ]
          },
          {
            "point_id": 15,
            "coords": [
              1,
              0,
              0,
              2
            ]
          },
          {
            "point_id": 26,
            "coords": [
              1,
              1,
              1,
              1
            ]
          },
          {
            "point_id": 37,
            "coords": [
              1,
              2,
              2,
              0
            ]
          }
        ]
      },
      {
        "rank": 8,
        "line_id": 15,
        "point_ids_ordered": [
          10,
          17,
          23,
          38
        ],
        "coords_ordered": [
          {
            "point_id": 10,
            "coords": [
              0,
              1,
              2,
              0
            ]
          },
          {
            "point_id": 17,
            "coords": [
              1,
              0,
              1,
              1
            ]
          },
          {
            "point_id": 23,
            "coords": [
              1,
              1,
              0,
              1
            ]
          },
          {
            "point_id": 38,
            "coords": [
              1,
              2,
              2,
              1
            ]
          }
        ]
      },
      {
        "rank": 9,
        "line_id": 10,
        "point_ids_ordered": [
          11,
          21,
          25,
          32
        ],
        "coords_ordered": [
          {
            "point_id": 11,
            "coords": [
              0,
              1,
              2,
              1
            ]
          },
          {
            "point_id": 21,
            "coords": [
              1,
              0,
              2,
              2
            ]
          },
          {
            "point_id": 25,
            "coords": [
              1,
              1,
              1,
              0
            ]
          },
          {
            "point_id": 32,
            "coords": [
              1,
              2,
              0,
              1
            ]
          }
        ]
      },
      {
        "rank": 10,
        "line_id": 19,
        "point_ids_ordered": [
          12,
          14,
          28,
          36
        ],
        "coords_ordered": [
          {
            "point_id": 12,
            "coords": [
              0,
              1,
              2,
              2
            ]
          },
          {
            "point_id": 14,
            "coords": [
              1,
              0,
              0,
              1
            ]
          },
          {
            "point_id": 28,
            "coords": [
              1,
              1,
              2,
              0
            ]
          },
          {
            "point_id": 36,
            "coords": [
              1,
              2,
              1,
              2
            ]
          }
        ]
      }
    ],
    "bases": [
      {
        "line_id": 0,
        "point_ids": [
          2,
          13,
          17,
          21
        ],
        "cards": [
          "2♡",
          "3♠",
          "8♡",
          "9♡"
        ]
      },
      {
        "line_id": 1,
        "point_ids": [
          2,
          4,
          8,
          12
        ],
        "cards": [
          "1♡",
          "3♠",
          "6♠",
          "10♠"
        ]
      },
      {
        "line_id": 2,
        "point_ids": [
          9,
          15,
          26,
          37
        ],
        "cards": [
          "7♠",
          "7♡",
          "7♢",
          "7♣"
        ]
      },
      {
        "line_id": 3,
        "point_ids": [
          10,
          14,
          29,
          35
        ],
        "cards": [
          "3♢",
          "4♣",
          "8♠",
          "10♡"
        ]
      },
      {
        "line_id": 4,
        "point_ids": [
          9,
          19,
          24,
          35
        ],
        "cards": [
          "2♣",
          "3♢",
          "6♢",
          "7♠"
        ]
      },
      {
        "line_id": 5,
        "point_ids": [
          12,
          18,
          23,
          37
        ],
        "cards": [
          "5♡",
          "7♣",
          "8♢",
          "10♠"
        ]
      },
      {
        "line_id": 6,
        "point_ids": [
          2,
          31,
          35,
          39
        ],
        "cards": [
          "3♠",
          "3♡",
          "3♢",
          "3♣"
        ]
      },
      {
        "line_id": 7,
        "point_ids": [
          8,
          20,
          24,
          34
        ],
        "cards": [
          "6♠",
          "6♡",
          "6♢",
          "6♣"
        ]
      },
      {
        "line_id": 8,
        "point_ids": [
          3,
          31,
          36,
          38
        ],
        "cards": [
          "3♡",
          "4♠",
          "8♣",
          "10♣"
        ]
      },
      {
        "line_id": 9,
        "point_ids": [
          10,
          20,
          26,
          32
        ],
        "cards": [
          "6♡",
          "7♢",
          "8♠",
          "9♣"
        ]
      },
      {
        "line_id": 10,
        "point_ids": [
          11,
          21,
          25,
          32
        ],
        "cards": [
          "9♠",
          "9♡",
          "9♢",
          "9♣"
        ]
      },
      {
        "line_id": 11,
        "point_ids": [
          3,
          13,
          18,
          20
        ],
        "cards": [
          "2♡",
          "4♠",
          "5♡",
          "6♡"
        ]
      },
      {
        "line_id": 12,
        "point_ids": [
          8,
          15,
          25,
          38
        ],
        "cards": [
          "6♠",
          "7♡",
          "8♣",
          "9♢"
        ]
      },
      {
        "line_id": 13,
        "point_ids": [
          2,
          22,
          26,
          30
        ],
        "cards": [
          "3♠",
          "4♡",
          "5♢",
          "7♢"
        ]
      },
      {
        "line_id": 14,
        "point_ids": [
          8,
          16,
          29,
          33
        ],
        "cards": [
          "2♢",
          "4♣",
          "5♣",
          "6♠"
        ]
      },
      {
        "line_id": 15,
        "point_ids": [
          10,
          17,
          23,
          38
        ],
        "cards": [
          "8♠",
          "8♡",
          "8♢",
          "8♣"
        ]
      },
      {
        "line_id": 16,
        "point_ids": [
          7,
          15,
          27,
          39
        ],
        "cards": [
          "3♣",
          "4♢",
          "5♠",
          "7♡"
        ]
      },
      {
        "line_id": 17,
        "point_ids": [
          0,
          4,
          5,
          6
        ],
        "cards": [
          "1♠",
          "1♡",
          "1♢",
          "1♣"
        ]
      },
      {
        "line_id": 18,
        "point_ids": [
          1,
          4,
          7,
          10
        ],
        "cards": [
          "1♡",
          "2♠",
          "5♠",
          "8♠"
        ]
      },
      {
        "line_id": 19,
        "point_ids": [
          12,
          14,
          28,
          36
        ],
        "cards": [
          "10♠",
          "10♡",
          "10♢",
          "10♣"
        ]
      },
      {
        "line_id": 20,
        "point_ids": [
          0,
          22,
          23,
          24
        ],
        "cards": [
          "1♠",
          "4♡",
          "6♢",
          "8♢"
        ]
      },
      {
        "line_id": 21,
        "point_ids": [
          5,
          16,
          26,
          36
        ],
        "cards": [
          "1♢",
          "2♢",
          "7♢",
          "10♣"
        ]
      },
      {
        "line_id": 22,
        "point_ids": [
          9,
          17,
          28,
          33
        ],
        "cards": [
          "5♣",
          "7♠",
          "8♡",
          "10♢"
        ]
      },
      {
        "line_id": 23,
        "point_ids": [
          3,
          22,
          27,
          29
        ],
        "cards": [
          "4♠",
          "4♡",
          "4♢",
          "4♣"
        ]
      },
      {
        "line_id": 24,
        "point_ids": [
          12,
          19,
          27,
          32
        ],
        "cards": [
          "2♣",
          "4♢",
          "9♣",
          "10♠"
        ]
      },
      {
        "line_id": 25,
        "point_ids": [
          5,
          18,
          25,
          35
        ],
        "cards": [
          "1♢",
          "3♢",
          "5♡",
          "9♢"
        ]
      },
      {
        "line_id": 26,
        "point_ids": [
          1,
          13,
          16,
          19
        ],
        "cards": [
          "2♠",
          "2♡",
          "2♢",
          "2♣"
        ]
      },
      {
        "line_id": 27,
        "point_ids": [
          3,
          4,
          9,
          11
        ],
        "cards": [
          "1♡",
          "4♠",
          "7♠",
          "9♠"
        ]
      },
      {
        "line_id": 28,
        "point_ids": [
          0,
          13,
          14,
          15
        ],
        "cards": [
          "1♠",
          "2♡",
          "7♡",
          "10♡"
        ]
      },
      {
        "line_id": 29,
        "point_ids": [
          11,
          16,
          23,
          39
        ],
        "cards": [
          "2♢",
          "3♣",
          "8♢",
          "9♠"
        ]
      },
      {
        "line_id": 30,
        "point_ids": [
          7,
          18,
          30,
          33
        ],
        "cards": [
          "5♠",
          "5♡",
          "5♢",
          "5♣"
        ]
      },
      {
        "line_id": 31,
        "point_ids": [
          0,
          31,
          32,
          33
        ],
        "cards": [
          "1♠",
          "3♡",
          "5♣",
          "9♣"
        ]
      },
      {
        "line_id": 32,
        "point_ids": [
          5,
          17,
          27,
          34
        ],
        "cards": [
          "1♢",
          "4♢",
          "6♣",
          "8♡"
        ]
      },
      {
        "line_id": 33,
        "point_ids": [
          11,
          14,
          30,
          34
        ],
        "cards": [
          "5♢",
          "6♣",
          "9♠",
          "10♡"
        ]
      },
      {
        "line_id": 34,
        "point_ids": [
          6,
          21,
          29,
          37
        ],
        "cards": [
          "1♣",
          "4♣",
          "7♣",
          "9♡"
        ]
      },
      {
        "line_id": 35,
        "point_ids": [
          6,
          19,
          30,
          38
        ],
        "cards": [
          "1♣",
          "2♣",
          "5♢",
          "8♣"
        ]
      },
      {
        "line_id": 36,
        "point_ids": [
          6,
          20,
          28,
          39
        ],
        "cards": [
          "1♣",
          "3♣",
          "6♡",
          "10♢"
        ]
      },
      {
        "line_id": 37,
        "point_ids": [
          7,
          21,
          24,
          36
        ],
        "cards": [
          "5♠",
          "6♢",
          "9♡",
          "10♣"
        ]
      },
      {
        "line_id": 38,
        "point_ids": [
          1,
          22,
          25,
          28
        ],
        "cards": [
          "2♠",
          "4♡",
          "9♢",
          "10♢"
        ]
      },
      {
        "line_id": 39,
        "point_ids": [
          1,
          31,
          34,
          37
        ],
        "cards": [
          "2♠",
          "3♡",
          "6♣",
          "7♣"
        ]
      }
    ],
    "incidence_stats": {
      "num_points": 40,
      "num_lines": 40,
      "line_size_set": [
        4
      ],
      "card_occurrence_counts_summary": {
        "min": 4,
        "max": 4,
        "hist": {
          "4": 40
        }
      }
    }
  },
  "notes": [
    "This produces a Witting-configuration table (40 points / 40 isotropic lines of W(3,3)) directly from the N12_58 symplectic mod-3 reduction output.",
    "The resulting table is isomorphic to Vlasov's Table III (and has the same incidence regularity: each card belongs to exactly 4 bases).",
    "Mapping to Vlasov's specific printed rank/suit ordering requires an additional isomorphism alignment step against his Table III entries; the present labeling is canonical given the chosen spread and lexicographic ordering of GF(3) coordinates."
  ],
  "full_code_used": "\nimport re, json, hashlib\nimport pandas as pd\nfrom collections import Counter\n\ndef parse_tuple_str(s):\n    nums=re.findall(r'-?\\d+', str(s))\n    return tuple(int(x) for x in nums)\n\ndef parse_list_ints(s):\n    return [int(x) for x in re.findall(r'\\d+', str(s))]\n\ndef sha256_file(path):\n    h=hashlib.sha256()\n    with open(path,'rb') as f:\n        for chunk in iter(lambda: f.read(1<<20), b''):\n            h.update(chunk)\n    return h.hexdigest()\n\n# Inputs\npts=pd.read_csv('/mnt/data/N12_58_W33_points.csv')\npts['coords']=pts['coords_GF3'].apply(parse_tuple_str)\n\nlines=pd.read_csv('/mnt/data/N12_58_W33_lines.csv')\nlines['point_ids']=lines['points'].apply(parse_list_ints)\n\nspread=pd.read_csv('/mnt/data/N12_58_W33_spread10_cards.csv')\nspread['point_ids']=spread['point_ids'].apply(parse_list_ints)\n\nsuit_symbols=['♠','♡','♢','♣']\nsuit_names=['S','H','D','C']\n\npoint_to_card={}\nrank_lines=[]\nfor _,row in spread.iterrows():\n    rank=int(row['rank'])\n    pids=row['point_ids']\n    pid_coords=[(pid, tuple(pts.loc[pts.point_id==pid,'coords'].iloc[0])) for pid in pids]\n    ordered=[pid for pid,_ in sorted(pid_coords, key=lambda x:x[1])]\n    rank_lines.append({\"rank\":rank,\"line_id\":int(row['line_id']),\"point_ids_ordered\":ordered})\n    for si,pid in enumerate(ordered):\n        card=f\"{rank}{suit_symbols[si]}\"\n        point_to_card[int(pid)]={\"rank\":rank,\"suit\":suit_symbols[si],\"suit_name\":suit_names[si],\"card\":card,\n                                 \"coords\":pts.loc[pts.point_id==pid,'coords'].iloc[0]}\n\nbases=[]\nfor _,row in lines.iterrows():\n    lid=int(row['line_id'])\n    pids=row['point_ids']\n    cards=[point_to_card[pid]['card'] for pid in pids]\n    bases.append({\"line_id\":lid,\"point_ids\":pids,\"cards\":cards})\n\n# Verify incidence regularity: each card appears in 4 bases\ncard_counts=Counter()\nfor b in bases:\n    for c in b['cards']:\n        card_counts[c]+=1\n\nassert len(point_to_card)==40\nassert len(bases)==40\nassert set(card_counts.values())=={4}\n\nout={\n  \"point_to_card\": [{\"point_id\":pid, **info} for pid,info in sorted(point_to_card.items())],\n  \"rank_lines\": rank_lines,\n  \"bases\": sorted(bases, key=lambda b:b[\"line_id\"]),\n  \"incidence_check\": {\"card_count_hist\": dict(Counter(card_counts.values()))}\n}\nprint(json.dumps(out, indent=2, default=str))\n"
}
